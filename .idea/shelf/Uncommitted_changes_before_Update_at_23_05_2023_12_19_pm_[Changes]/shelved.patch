Index: app.py
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+># install Pyqt5 & Qt designer by \"pip install pyqt5\" , \"pip install pyqt5-tools\"\r\n\r\nimport sys\r\nimport time\r\nimport databaseSQL\r\nimport models\r\nfrom PyQt5.uic import loadUi\r\nfrom PyQt5 import QtWidgets, QtGui, QtCore\r\nfrom PyQt5.QtWidgets import *\r\nfrom PyQt5.QtCore import *\r\nfrom PyQt5.QtGui import *\r\nfrom datetime import datetime\r\n\r\ndb = databaseSQL.database()\r\n\r\nloggedInUser = models.Account()\r\nselectedTrain = models.Train()\r\nselected = False\r\nselectedTrip = models.Trip()\r\nselectedBooking = models.Booking()\r\nmatchingTrips = []\r\n\r\nclass SplashScreen(QSplashScreen):\r\n    def __init__(self):\r\n        super(SplashScreen, self).__init__()\r\n        loadUi(\"ui/splash.ui\", self)\r\n        self.setWindowFlag(Qt.FramelessWindowHint)\r\n        pixMap = QPixmap(\"img/splash.png\")\r\n        self.setPixmap(pixMap)\r\n        self.show()\r\n        self.progress()\r\n\r\n    def progress(self):\r\n        for i in range(100):\r\n            time.sleep(0.01)\r\n            self.progressBar.setValue(i)\r\n\r\n\r\nclass MainScreen(QMainWindow):\r\n    def __init__(self):\r\n        super(MainScreen, self).__init__()\r\n        loadUi(\"ui/main.ui\", self)\r\n        self.login.clicked.connect(self.gotologin)\r\n        self.signup.clicked.connect(self.gotosignup)\r\n\r\n    def gotologin(self):\r\n        login = LoginScreen()\r\n        widget.addWidget(login)\r\n        widget.setCurrentIndex(widget.currentIndex() + 1)\r\n\r\n    def gotosignup(self):\r\n        signup = SignupScreen()\r\n        widget.addWidget(signup)\r\n        widget.setCurrentIndex(widget.currentIndex() + 1)\r\n\r\n\r\nclass LoginScreen(QDialog):\r\n    def __init__(self):\r\n        super(LoginScreen, self).__init__()\r\n        loadUi(\"ui/Login.ui\", self)\r\n        self.inputPassword.setEchoMode(QtWidgets.QLineEdit.Password)\r\n        self.loginButton.clicked.connect(self.loginfunction)\r\n        self.returnButton.clicked.connect(self.returnPrevScreen)\r\n\r\n    def returnPrevScreen(self):\r\n        widget.removeWidget(self)\r\n\r\n    def validateLogin(self):\r\n        email = self.inputEmail.text()\r\n        password = self.inputPassword.text()\r\n        if len(email) == 0 or len(password) == 0:\r\n            self.error.setText(\"Please input email and password!\")\r\n            return False\r\n        else:\r\n            self.error.setText(\"\")\r\n            for row in db.selectAll(\"Account\", f\"email ='{email}' and password ='{password}'\"):\r\n                loggedInUser.account_id = row.account_id\r\n                loggedInUser.name = row.name\r\n                loggedInUser.email = row.email\r\n                loggedInUser.password = row.password\r\n                loggedInUser.phone_num = row.phone_num\r\n                loggedInUser.address = row.address\r\n                loggedInUser.date_of_birth = row.date_of_birth\r\n                loggedInUser.role = row.role\r\n                return True\r\n            return False\r\n\r\n    def loginfunction(self):\r\n        if self.validateLogin():\r\n            self.inputEmail.setText(\"\")\r\n            self.inputPassword.setText(\"\")\r\n            if loggedInUser.role == \"admin\":\r\n                admin = AdminOptionsScreen()\r\n                widget.addWidget(admin)\r\n                widget.setCurrentIndex(widget.currentIndex() + 1)\r\n            elif loggedInUser.role == \"customer\":\r\n                customer = UserOptionsScreen()\r\n                widget.addWidget(customer)\r\n                widget.setCurrentIndex(widget.currentIndex() + 1)\r\n        else:\r\n            if self.error.text() == \"\":\r\n                self.error.setText(\"Invalid email and password!\")\r\n\r\n\r\nclass SignupScreen(QDialog):\r\n    def __init__(self):\r\n        super(SignupScreen, self).__init__()\r\n        loadUi(\"ui/Signup.ui\", self)\r\n        self.inputPassword.setEchoMode(QtWidgets.QLineEdit.Password)\r\n        self.signupButton.clicked.connect(self.signupfunction)\r\n        self.returnButton.clicked.connect(self.returnPrevScreen)\r\n        # restrictions for input fields\r\n        txtRegex = QRegExp(\"[a-zA-Z]+\")\r\n        stringValidator = QRegExpValidator(txtRegex)\r\n        intValidator = QtGui.QIntValidator()\r\n        self.inputName.setValidator(stringValidator)\r\n        self.inputNumber.setValidator(intValidator)\r\n\r\n    def returnPrevScreen(self):\r\n        widget.removeWidget(self)\r\n\r\n    def showMessageBox(self):\r\n        msg = QMessageBox()\r\n        msg.setWindowTitle(\"Success registration!\")\r\n        msg.setText(\"Signed up successfully!\")\r\n        msg.setIcon(QMessageBox.Information)\r\n        msg.exec_()\r\n\r\n    def uniqueEmail(self, mail):\r\n        unique = True\r\n        if db.count(\"Account\", f\"email ='{mail}'\") == 1:\r\n            unique = False\r\n        return unique\r\n\r\n    def signupfunction(self):\r\n        # reset error msg\r\n        self.error.setText(\"\")\r\n        self.emailError.setText(\"\")\r\n\r\n        name = self.inputName.text()\r\n        email = self.inputEmail.text()\r\n        password = self.inputPassword.text()\r\n        phoneNum = self.inputNumber.text()\r\n        dob = self.inputDob.text()\r\n        address = self.inputAddress.text()\r\n\r\n        if not self.uniqueEmail(email):\r\n            self.error.setText(\"\")\r\n            self.errorMsg.setText(\"\")\r\n            self.emailError.setText(\"An account is already registered with your email!\")\r\n        elif len(name) == 0 or len(email) == 0 or len(password) == 0 or len(phoneNum) == 0 or len(address) == 0:\r\n            self.error.setText(\"\")\r\n            self.emailError.setText(\"\")\r\n            self.errorMsg.setText(\"Please input all the required fields!\")\r\n        # see which is checked, then add it\r\n        elif self.adminRadioButton.isChecked():\r\n            self.showMessageBox()\r\n            acc = models.Admin()\r\n            acc.name = name\r\n            acc.email = email\r\n            acc.password = password\r\n            acc.phone_num = phoneNum\r\n            acc.date_of_birth = dob\r\n            acc.address = address\r\n            db.addRecord(acc)\r\n            self.returnPrevScreen()\r\n        elif self.customerRadioButton.isChecked():\r\n            self.showMessageBox()\r\n            acc = models.Customer()\r\n            acc.name = name\r\n            acc.email = email\r\n            acc.password = password\r\n            acc.phone_num = phoneNum\r\n            acc.date_of_birth = dob\r\n            acc.address = address\r\n            db.addRecord(acc)\r\n            self.returnPrevScreen()\r\n        else:\r\n            self.errorMsg.setText(\"\")\r\n            self.error.setText(\"Please choose a role!\")\r\n\r\n\r\nclass UpdateUserScreen(QDialog):\r\n    def __init__(self):\r\n        super(UpdateUserScreen, self).__init__()\r\n        loadUi(\"ui/UpdateUser.ui\", self)\r\n        self.returnButton.clicked.connect(self.returnPrevScreen)\r\n        self.updateUserButton.clicked.connect(self.updateuserfunction)\r\n        self.loadUserInfo()\r\n        # restrictions for input fields\r\n        txtRegex = QRegExp(\"[a-zA-Z]+\")\r\n        stringValidator = QRegExpValidator(txtRegex)\r\n        intValidator = QtGui.QIntValidator()\r\n        self.inputName.setValidator(stringValidator)\r\n        self.inputNumber.setValidator(intValidator)\r\n        self.inputDob.setReadOnly(True)\r\n        self.inputEmail.setReadOnly(True)\r\n\r\n    def returnPrevScreen(self):\r\n        widget.removeWidget(self)\r\n\r\n    def showMessageBox(self):\r\n        msg = QMessageBox()\r\n        msg.setWindowTitle(\"Success changes!\")\r\n        msg.setText(\"Profile updated successfully!\")\r\n        msg.setIcon(QMessageBox.Information)\r\n        msg.exec_()\r\n\r\n    def loadUserInfo(self):\r\n        # extract the date\r\n        year = int(loggedInUser.date_of_birth[0:4])\r\n        month = int(loggedInUser.date_of_birth[5:7])\r\n        day = int(loggedInUser.date_of_birth[8:10])\r\n\r\n        self.inputDob.setDate(QDate(year, month, day))\r\n        self.inputName.setText(loggedInUser.name)\r\n        self.inputEmail.setText(loggedInUser.email)\r\n        self.inputPassword.setText(loggedInUser.password)\r\n        self.inputNumber.setText(loggedInUser.phone_num)\r\n        self.inputAddress.setText(loggedInUser.address)\r\n        if loggedInUser.role == \"admin\":\r\n            self.adminRadioButton.setChecked(True)\r\n        elif loggedInUser.role == \"customer\":\r\n            self.customerRadioButton.setChecked(True)\r\n\r\n        self.adminRadioButton.setEnabled(False)\r\n        self.customerRadioButton.setEnabled(False)\r\n\r\n    def updateuserfunction(self):\r\n        self.showMessageBox()\r\n        acc = models.Account()\r\n        acc.account_id = loggedInUser.account_id\r\n        acc.name = self.inputName.text()\r\n        acc.email = self.inputEmail.text()\r\n        acc.password = self.inputPassword.text()\r\n        acc.phone_num = self.inputNumber.text()\r\n        acc.date_of_birth = loggedInUser.date_of_birth\r\n        acc.address = self.inputAddress.text()\r\n        db.update(acc)\r\n        # update the current info of logged in user if updated\r\n        loggedInUser.name = acc.name\r\n        loggedInUser.email = acc.email\r\n        loggedInUser.password = acc.password\r\n        loggedInUser.phone_num = acc.phone_num\r\n        loggedInUser.address = acc.address\r\n        self.returnPrevScreen()\r\n\r\n\r\nclass AddTrainScreen(QDialog):\r\n    def __init__(self):\r\n        super(AddTrainScreen, self).__init__()\r\n        loadUi(\"ui/AddTrain.ui\", self)\r\n        self.returnButton.clicked.connect(self.returnPrevScreen)\r\n        self.addTrainButton.clicked.connect(self.addtrainfunction)\r\n\r\n        intValidator = QtGui.QIntValidator()\r\n        txtRegex = QRegExp(\"[a-zA-Z]+\")\r\n        stringValidator = QRegExpValidator(txtRegex)\r\n        self.inputCapacity.setValidator(intValidator)\r\n        self.inputNumofcart.setValidator(intValidator)\r\n        self.inputManufacturer.setValidator(stringValidator)\r\n\r\n    def returnPrevScreen(self):\r\n        widget.removeWidget(self)\r\n\r\n    def showMessageBox(self):\r\n        msg = QMessageBox()\r\n        msg.setWindowTitle(\"Success addition!\")\r\n        msg.setText(\"Train added successfully!\")\r\n        msg.setIcon(QMessageBox.Information)\r\n        msg.exec_()\r\n\r\n    def addtrainfunction(self):\r\n        cap = self.inputCapacity.text()\r\n        numOfCart = self.inputNumofcart.text()\r\n        manufacture = self.inputManufacturer.text()\r\n        if len(cap) == 0 or len(numOfCart) == 0 or len(\r\n                manufacture) == 0 or (\r\n                not self.activeRadioButton.isChecked() and not self.inactiveRadioButton.isChecked()):\r\n            self.error.setText(\"Please input all the required fields!\")\r\n        else:\r\n            self.showMessageBox()\r\n            train = models.Train()\r\n            train.capacity = int(cap)\r\n            train.no_of_cart = int(numOfCart)\r\n            train.manufacture = manufacture\r\n            if self.activeRadioButton.isChecked():\r\n                train.status = \"active\"\r\n            elif self.inactiveRadioButton.isChecked():\r\n                train.status = \"inactive\"\r\n            db.addRecord(train)\r\n            self.returnPrevScreen()\r\n\r\n\r\nclass ShowAllTrains(QDialog):\r\n    def __init__(self):\r\n        super(ShowAllTrains, self).__init__()\r\n        loadUi(\"ui/ShowTrains.ui\", self)\r\n        self.tableWidget.setColumnWidth(0, 100)\r\n        self.tableWidget.setColumnWidth(1, 100)\r\n        self.tableWidget.setColumnWidth(2, 100)\r\n        self.tableWidget.setColumnWidth(3, 150)\r\n        self.tableWidget.setColumnWidth(4, 200)\r\n        self.tableWidget.setHorizontalHeaderLabels([\"Train ID\", \"Capacity\", \"Status\", \"Number of cart\", \"Manufacturer\"])\r\n        self.tableWidget.setSelectionBehavior(QTableView.SelectRows)\r\n        self.loadTrains()\r\n        self.selectTrainButton.clicked.connect(self.gotoupdatetrain)\r\n        self.returnButton.clicked.connect(self.returnPrevScreen)\r\n        self.tableWidget.cellClicked.connect(self.getClickedCell)\r\n\r\n    def clearSelected(self):\r\n        global selected\r\n        selected = False\r\n        # reset the selected train data to none\r\n        selectedTrain.train_id = \"\"\r\n        selectedTrain.status = \"\"\r\n        selectedTrain.capacity = \"\"\r\n        selectedTrain.manufacture = \"\"\r\n        selectedTrain.no_of_cart = \"\"\r\n\r\n    def getClickedCell(self, row):\r\n        global selected\r\n        selected = True\r\n        # move the clicked row data to update train screen\r\n        selectedTrain.train_id = self.tableWidget.item(row, 0).text()\r\n        selectedTrain.capacity = self.tableWidget.item(row, 1).text()\r\n        selectedTrain.status = self.tableWidget.item(row, 2).text()\r\n        selectedTrain.no_of_cart = self.tableWidget.item(row, 3).text()\r\n        selectedTrain.manufacture = self.tableWidget.item(row, 4).text()\r\n\r\n    def returnPrevScreen(self):\r\n        self.clearSelected()\r\n        widget.removeWidget(self)\r\n\r\n    def loadTrains(self):\r\n        self.tableWidget.setRowCount(db.count(\"Train\"))\r\n        tableRow = 0\r\n        for row in db.selectAll(\"Train\"):\r\n            self.tableWidget.setItem(tableRow, 0, QtWidgets.QTableWidgetItem(str(row.train_id)))\r\n            self.tableWidget.setItem(tableRow, 1, QtWidgets.QTableWidgetItem(str(row.capacity)))\r\n            self.tableWidget.setItem(tableRow, 2, QtWidgets.QTableWidgetItem(row.status))\r\n            self.tableWidget.setItem(tableRow, 3, QtWidgets.QTableWidgetItem(str(row.no_of_cart)))\r\n            self.tableWidget.setItem(tableRow, 4, QtWidgets.QTableWidgetItem(row.manufacture))\r\n            tableRow += 1\r\n\r\n    def gotoupdatetrain(self):\r\n        if selected:\r\n            self.error.setText(\"\")\r\n            updateTrain = UpdateTrainScreen()\r\n            widget.addWidget(updateTrain)\r\n            widget.setCurrentIndex(widget.currentIndex() + 1)\r\n        else:\r\n            self.error.setText(\"Please select a train to update!\")\r\n\r\n\r\nclass UpdateTrainScreen(QDialog):\r\n    def __init__(self):\r\n        super(UpdateTrainScreen, self).__init__()\r\n        loadUi(\"ui/UpdateTrain.ui\", self)\r\n        self.returnButton.clicked.connect(self.returnPrevScreen)\r\n        self.updateTrainButton.clicked.connect(self.updatetrainfunction)\r\n        self.loadTrainInfo()\r\n        intValidator = QtGui.QIntValidator()\r\n        txtRegex = QRegExp(\"[a-zA-Z]+\")\r\n        stringValidator = QRegExpValidator(txtRegex)\r\n        self.inputCapacity.setValidator(intValidator)\r\n        self.inputNumofcart.setValidator(intValidator)\r\n        self.inputManufacturer.setValidator(stringValidator)\r\n        self.inputCapacity.setReadOnly(True)\r\n\r\n    def showMessageBox(self):\r\n        msg = QMessageBox()\r\n        msg.setWindowTitle(\"Success changes!\")\r\n        msg.setText(\"Train updated successfully!\")\r\n        msg.setIcon(QMessageBox.Information)\r\n        msg.exec_()\r\n\r\n    def clearSelected(self):\r\n        global selected\r\n        selected = False\r\n        # reset the selected train data to none\r\n        selectedTrain.train_id = \"\"\r\n        selectedTrain.status = \"\"\r\n        selectedTrain.capacity = \"\"\r\n        selectedTrain.manufacture = \"\"\r\n        selectedTrain.no_of_cart = \"\"\r\n\r\n    def returnPrevScreen(self):\r\n        widget.removeWidget(self)\r\n\r\n    def loadTrainInfo(self):\r\n        self.inputCapacity.setText(selectedTrain.capacity)\r\n        self.inputNumofcart.setText(selectedTrain.no_of_cart)\r\n        self.inputManufacturer.setText(selectedTrain.manufacture)\r\n        if selectedTrain.status == \"active\":\r\n            self.activeRadioButton.setChecked(True)\r\n        elif selectedTrain.status == \"inactive\":\r\n            self.inactiveRadioButton.setChecked(True)\r\n\r\n    def updatetrainfunction(self):\r\n        cap = self.inputCapacity.text()\r\n        numOfCart = self.inputNumofcart.text()\r\n        manufacture = self.inputManufacturer.text()\r\n        if len(cap) == 0 or len(numOfCart) == 0 or len(\r\n                manufacture) == 0 or (\r\n                not self.activeRadioButton.isChecked() and not self.inactiveRadioButton.isChecked()):\r\n            self.error.setText(\"Cannot update without the required fields!\")\r\n        else:\r\n            self.showMessageBox()\r\n            selectedTrain.capacity = cap\r\n            selectedTrain.no_of_cart = numOfCart\r\n            selectedTrain.manufacture = manufacture\r\n            if self.activeRadioButton.isChecked():\r\n                selectedTrain.status = \"active\"\r\n            elif self.inactiveRadioButton.isChecked():\r\n                selectedTrain.status = \"inactive\"\r\n            # update the selected train data\r\n            db.update(selectedTrain)\r\n            self.returnPrevScreen()\r\n            self.clearSelected()\r\n            widget.removeWidget(widget.currentWidget())\r\n\r\n\r\nclass AddTripScreen(QDialog):\r\n    def __init__(self):\r\n        super(AddTripScreen, self).__init__()\r\n        # load UI\r\n        loadUi(\"ui/AddTrip.ui\", self)\r\n        self.returnButton.clicked.connect(self.returnPrevScreen)\r\n        self.addTripButton.clicked.connect(self.addtripfunction)\r\n        self.inputStartDate.setMinimumDateTime(QtCore.QDateTime.currentDateTime())\r\n        self.inputEndDate.setMinimumDateTime(QtCore.QDateTime.currentDateTime())\r\n        self.inputStartDate.setDateTime(QtCore.QDateTime.currentDateTime())\r\n        self.inputEndDate.setDateTime(QtCore.QDateTime.currentDateTime())\r\n\r\n        intValidator = QtGui.QIntValidator()\r\n        floatValidator = QtGui.QDoubleValidator()\r\n        txtRegex = QRegExp(\"[a-zA-Z]+\")\r\n        stringValidator = QRegExpValidator(txtRegex)\r\n        self.inputPrice.setValidator(floatValidator)\r\n        self.inputDepartureStation.setValidator(stringValidator)\r\n        self.inputArrivalStation.setValidator(stringValidator)\r\n        self.inputTrainID.setValidator(intValidator)\r\n    def showMessageBox(self):\r\n        msg = QMessageBox()\r\n        msg.setWindowTitle(\"Success changes!\")\r\n        msg.setText(\"Trip added successfully!\")\r\n        msg.setIcon(QMessageBox.Information)\r\n        msg.exec_()\r\n    def returnPrevScreen(self):\r\n        widget.removeWidget(self)\r\n    def addtripfunction(self):\r\n        price = self.inputPrice.text()\r\n        departure = self.inputDepartureStation.text()\r\n        arrival = self.inputArrivalStation.text()\r\n        trainID =self.inputTrainID.text()\r\n        startdate = self.inputStartDate.dateTime().toPyDateTime().strftime(\"%Y-%m-%d %H:%M\")\r\n        enddate = self.inputEndDate.dateTime().toPyDateTime().strftime(\"%Y-%m-%d %H:%M\")\r\n        if len(str(price)) == 0 or len(departure) == 0 or len(arrival) == 0 or len(trainID) == 0:\r\n            self.error.setText(\"Cannot add without the required fields!\")\r\n        elif not db.count(\"Train\", f\"train_id ='{trainID}'\") == 1:\r\n            self.error.setText(\"Train ID doesn't exist!\")\r\n        elif startdate >= enddate:\r\n            self.error.setText(\"Start date must be before end date!\")\r\n        else:\r\n            train = db.selectAll(\"Train\" , f\"train_id = '{int(trainID)}'\")[0]\r\n            trip = models.Trip()\r\n            trip.train = train\r\n            trip.price = float(price)\r\n            trip.departure_station = departure\r\n            trip.arrival_station = arrival\r\n            trip.start_date = startdate\r\n            trip.end_date = enddate\r\n            db.addRecord(trip)\r\n            self.showMessageBox()\r\n            widget.removeWidget(widget.currentWidget())\r\n\r\n\r\nclass UpdateTripScreen(QDialog):\r\n    def __init__(self):\r\n        super(UpdateTripScreen, self).__init__()\r\n        loadUi(\"ui/UpdateTrip.ui\", self)\r\n        self.returnButton.clicked.connect(self.returnPrevScreen)\r\n        self.updateTripButton.clicked.connect(self.updatetripfunction)\r\n        self.inputStartDate.setMinimumDateTime(datetime.now())\r\n        self.inputEndDate.setMinimumDateTime(datetime.now())\r\n        self.loadTripInfo()\r\n        intValidator = QtGui.QIntValidator()\r\n        floatValidator = QtGui.QDoubleValidator()\r\n        txtRegex = QRegExp(\"[a-zA-Z]+\")\r\n        stringValidator = QRegExpValidator(txtRegex)\r\n        self.inputPrice.setValidator(floatValidator)\r\n        self.inputDepartureStation.setValidator(stringValidator)\r\n        self.inputArrivalStation.setValidator(stringValidator)\r\n        self.inputTrainID.setValidator(intValidator)\r\n\r\n    def showMessageBox(self):\r\n        msg = QMessageBox()\r\n        msg.setWindowTitle(\"Success changes!\")\r\n        msg.setText(\"Trip updated successfully!\")\r\n        msg.setIcon(QMessageBox.Information)\r\n        msg.exec_()\r\n\r\n    def returnPrevScreen(self):\r\n        widget.removeWidget(self)\r\n\r\n    def loadTripInfo(self):\r\n        self.inputPrice.setText(str(selectedTrip.price))\r\n        self.inputDepartureStation.setText(selectedTrip.departure_station)\r\n        self.inputArrivalStation.setText(selectedTrip.arrival_station)\r\n        self.inputTrainID.setText(str(selectedTrip.train.train_id))\r\n        startDate = datetime.strptime(selectedTrip.start_date, '%Y-%m-%d %H:%M')\r\n        endDate = datetime.strptime(selectedTrip.end_date, '%Y-%m-%d %H:%M')\r\n        self.inputStartDate.setDateTime(startDate)\r\n        self.inputEndDate.setDateTime(endDate)\r\n\r\n    def updatetripfunction(self):\r\n        price = self.inputPrice.text()\r\n        departure = self.inputDepartureStation.text()\r\n        arrival = self.inputArrivalStation.text()\r\n        trainID = self.inputTrainID.text()\r\n        startdate = self.inputStartDate.dateTime().toPyDateTime().strftime(\"%Y-%m-%d %H:%M\")\r\n        enddate = self.inputEndDate.dateTime().toPyDateTime().strftime(\"%Y-%m-%d %H:%M\")\r\n        if len(str(price)) == 0 or len(departure) == 0 or len(arrival) == 0 or len(trainID) == 0:\r\n            self.error.setText(\"Cannot add without the required fields!\")\r\n        elif startdate >= enddate:\r\n            self.error.setText(\"Start date must be before end date!\")\r\n        else:\r\n            selectedTrip.price = price\r\n            selectedTrip.departure_station = departure\r\n            selectedTrip.arrival_station = arrival\r\n            selectedTrip.train = db.selectAll(\"Train\", f\"train_id = '{int(trainID)}'\")[0]\r\n            selectedTrip.start_date = startdate\r\n            selectedTrip.end_date = enddate\r\n            db.update(selectedTrip)\r\n            self.showMessageBox()\r\n            self.returnPrevScreen()\r\n            widget.removeWidget(widget.currentWidget())\r\n\r\n\r\nclass ShowAllTrips(QDialog):\r\n    def __init__(self):\r\n        super(ShowAllTrips, self).__init__()\r\n        # load UI\r\n        loadUi(\"ui/ShowTrips.ui\", self)\r\n        #make coulmn width fit the content\r\n        self.tableWidget.horizontalHeader().setSectionResizeMode(QHeaderView.ResizeToContents)\r\n        self.tableWidget.setHorizontalHeaderLabels([\"Trip Id\",\"Departure Station\", \"Arrival Station\", \"Price\", \"Start Date\", \"End Date\", \"Train ID\"])\r\n        self.tableWidget.setSelectionBehavior(QTableView.SelectRows)\r\n        self.loadTrips()\r\n        self.returnButton.clicked.connect(self.returnPrevScreen)\r\n        self.tableWidget.doubleClicked.connect(self.getClickedCell)\r\n        self.instructionLabel.setText(\"Please double click on the trip to update it :)\")\r\n\r\n    def getClickedCell(self, index):\r\n        row = index.row()\r\n        column = index.column()\r\n\r\n        if column >= 0:\r\n            selectedTrip.trip_id = self.tableWidget.item(row, 0).text()\r\n            selectedTrip.departure_station = self.tableWidget.item(row, 1).text()\r\n            selectedTrip.arrival_station = self.tableWidget.item(row, 2).text()\r\n            selectedTrip.price = float(self.tableWidget.item(row, 3).text())\r\n            selectedTrip.start_date = self.tableWidget.item(row, 4).text()\r\n            selectedTrip.end_date = self.tableWidget.item(row, 5).text()\r\n            trainid = int(self.tableWidget.item(row, 6).text())\r\n            selectedTrip.train = db.selectAll(\"Train\", f\"train_id = '{trainid}'\")[0]\r\n            self.action()\r\n\r\n    def clearSelected(self):\r\n        # reset the selected train data to none\r\n        selectedTrip.departure_station = \"\"\r\n        selectedTrip.arrival_station = \"\"\r\n        selectedTrip.price = \"\"\r\n        selectedTrip.start_date = \"\"\r\n        selectedTrip.end_date = \"\"\r\n        selectedTrip.train = None\r\n    def returnPrevScreen(self):\r\n        self.clearSelected()\r\n        widget.removeWidget(self)\r\n\r\n    def loadTrips(self):\r\n        current_datetime = datetime.now().strftime(\"%Y-%m-%d %H:%M\")\r\n        self.tableWidget.setRowCount(db.count(\"Trip\",f\"start_date >= '{current_datetime}'\"))\r\n        tableRow = 0\r\n        for row in db.selectAll(\"Trip\", f\"start_date >= '{current_datetime}'\"):\r\n            self.tableWidget.setItem(tableRow, 0, QtWidgets.QTableWidgetItem(str(row.trip_id)))\r\n            self.tableWidget.setItem(tableRow, 1, QtWidgets.QTableWidgetItem(row.departure_station))\r\n            self.tableWidget.setItem(tableRow, 2, QtWidgets.QTableWidgetItem(row.arrival_station))\r\n            self.tableWidget.setItem(tableRow, 3, QtWidgets.QTableWidgetItem(str(row.price)))\r\n            self.tableWidget.setItem(tableRow, 4, QtWidgets.QTableWidgetItem(str(row.start_date)))\r\n            self.tableWidget.setItem(tableRow, 5, QtWidgets.QTableWidgetItem(str(row.end_date)))\r\n            self.tableWidget.setItem(tableRow, 6, QtWidgets.QTableWidgetItem(str(row.train.train_id)))\r\n            tableRow += 1\r\n\r\n    def action(self):\r\n        if loggedInUser.role == \"admin\":\r\n            widget.addWidget(UpdateTripScreen())\r\n            widget.setCurrentIndex(widget.currentIndex() + 1)\r\n        else:\r\n            widget.addWidget(BookTripScreen())\r\n            widget.setCurrentIndex(widget.currentIndex() + 1)\r\n\r\n\r\nclass BookTripScreen(QDialog):\r\n    def __init__(self):\r\n        super(BookTripScreen, self).__init__()\r\n        loadUi(\"ui/BookTrip.ui\", self)\r\n        self.returnButton.clicked.connect(self.returnPrevScreen)\r\n        self.bookTripButton.clicked.connect(self.booktripfunction)\r\n        self.loadTripInfo()\r\n        self.seatCountInput.textChanged.connect(self.updateTotalPrice)\r\n\r\n    def clearSelected(self):\r\n        # reset the selected train data to none\r\n        selectedTrip.trip_id = \"\"\r\n        selectedTrip.departure_station = \"\"\r\n        selectedTrip.arrival_station = \"\"\r\n        selectedTrip.price = \"\"\r\n        selectedTrip.start_date = \"\"\r\n        selectedTrip.end_date = \"\"\r\n    def returnPrevScreen(self):\r\n        self.clearSelected()\r\n        widget.removeWidget(self)\r\n\r\n    def gotoallbookings(self):\r\n        allBooking = ShowBookings()\r\n        widget.addWidget(allBooking)\r\n        widget.setCurrentIndex(widget.currentIndex() + 1)\r\n\r\n    def loadTripInfo(self):\r\n        self.departureStationLabel.setText(selectedTrip.departure_station)\r\n        self.arrivalStationLabel.setText(selectedTrip.arrival_station)\r\n        self.startDateLabel.setText(selectedTrip.start_date)\r\n        self.endDateLabel.setText(selectedTrip.end_date)\r\n        self.totalPriceLabel.setText(str(selectedTrip.price))\r\n\r\n    def updateTotalPrice(self):\r\n        numofseats = self.seatCountInput.text()\r\n        if len(numofseats) == 0:\r\n            self.totalPriceLabel.setText(\"0\")\r\n        else:\r\n            self.totalPriceLabel.setText(str(int(numofseats) * int(selectedTrip.price)))\r\n    def showMessageBox(self):\r\n        msg = QMessageBox()\r\n        msg.setWindowTitle(\"Success Booking!\")\r\n        msg.setText(\"Successfully booked the trip!\")\r\n        msg.setIcon(QMessageBox.Information)\r\n        msg.exec_()\r\n    def booktripfunction(self):\r\n        numofseats = self.seatCountInput.text()\r\n\r\n        if int(numofseats) > db.count(\"Seat\",f\"status = 'available' and trip_id = '{selectedTrip.trip_id}';\"):\r\n            self.error.setText(\"Not enough seats!\")\r\n        elif db.selectAll(\"Booking\", f\"account.account_id = '{loggedInUser.account_id}' and trip.trip_id = '{selectedTrip.trip_id}'\"):\r\n            booking = db.selectAll(\"Booking\", f\"account.account_id = '{loggedInUser.account_id}' and trip.trip_id = '{selectedTrip.trip_id}'\")[0]\r\n            booking.set_seats_num(booking.no_of_seats + int(numofseats))\r\n            db.update(booking)\r\n            self.showMessageBox()\r\n            self.clearSelected()\r\n            self.returnPrevScreen()\r\n            self.clearSelected()\r\n            widget.removeWidget(widget.currentWidget())\r\n            self.gotoallbookings()\r\n        else:\r\n            book = models.Booking()\r\n            book.trip = selectedTrip\r\n            book.account = loggedInUser\r\n            book.set_seats_num(int(numofseats))\r\n            db.addRecord(book)\r\n            self.showMessageBox()\r\n            self.clearSelected()\r\n            self.returnPrevScreen()\r\n            widget.removeWidget(widget.currentWidget())\r\n            self.gotoallbookings()\r\n\r\n\r\nclass ShowBookings(QDialog):\r\n    def __init__(self):\r\n        super(ShowBookings, self).__init__()\r\n        # load UI\r\n        loadUi(\"ui/ShowBookings.ui\", self)\r\n        #make coulmn width fit the content\r\n        self.tableWidget.horizontalHeader().setSectionResizeMode(QHeaderView.ResizeToContents)\r\n        self.tableWidget.setHorizontalHeaderLabels([\"Booking ID\", \"Departure Station\", \"Arrival Station\", \"Departure Date\", \"Arrival Date\",\"Seat Count\" , \"Price\",\"Train ID\", \"Trip ID\"])\r\n        self.tableWidget.setSelectionBehavior(QTableView.SelectRows)\r\n        self.loadBookings()\r\n        self.returnButton.clicked.connect(self.returnPrevScreen)\r\n        self.tableWidget.doubleClicked.connect(self.getClickedCell)\r\n        self.instructionLabel.setText(\"Please double click on the trip to cancel it :(\")\r\n\r\n    def returnPrevScreen(self):\r\n        widget.removeWidget(self)\r\n    def loadBookings(self):\r\n        self.tableWidget.setRowCount(db.count(\"Booking\",f\"account.account_id = '{loggedInUser.account_id}'\"))\r\n        tableRow = 0\r\n        for row in db.selectAll(\"Booking\",f\"account.account_id = '{loggedInUser.account_id}'\"):\r\n            self.tableWidget.setItem(tableRow, 0, QtWidgets.QTableWidgetItem(str(row.booking_id)))\r\n            self.tableWidget.setItem(tableRow, 1, QtWidgets.QTableWidgetItem(row.trip.departure_station))\r\n            self.tableWidget.setItem(tableRow, 2, QtWidgets.QTableWidgetItem(row.trip.arrival_station))\r\n            self.tableWidget.setItem(tableRow, 3, QtWidgets.QTableWidgetItem(str(row.trip.start_date)))\r\n            self.tableWidget.setItem(tableRow, 4, QtWidgets.QTableWidgetItem(str(row.trip.end_date)))\r\n            self.tableWidget.setItem(tableRow, 5, QtWidgets.QTableWidgetItem(str(row.no_of_seats)))\r\n            self.tableWidget.setItem(tableRow, 6, QtWidgets.QTableWidgetItem(str(row.price)))\r\n            self.tableWidget.setItem(tableRow, 7, QtWidgets.QTableWidgetItem(str(row.trip.train.train_id)))\r\n            self.tableWidget.setItem(tableRow, 8, QtWidgets.QTableWidgetItem(str(row.trip.trip_id)))\r\n            tableRow += 1\r\n\r\n    def getClickedCell(self):\r\n        selectedRow = self.tableWidget.currentRow()\r\n        selectedBooking.booking_id = self.tableWidget.item(selectedRow, 0).text()\r\n        selectedTrip.trip_id = self.tableWidget.item(selectedRow, 8).text()\r\n        selectedTrip.departure_station = self.tableWidget.item(selectedRow, 1).text()\r\n        selectedTrip.arrival_station = self.tableWidget.item(selectedRow, 2).text()\r\n        selectedTrip.start_date = self.tableWidget.item(selectedRow, 3).text()\r\n        selectedTrip.end_date = self.tableWidget.item(selectedRow, 4).text()\r\n        selectedBooking.no_of_seats = self.tableWidget.item(selectedRow, 5).text()\r\n        selectedBooking.price = self.tableWidget.item(selectedRow, 6).text()\r\n        selectedTrip.train_id = self.tableWidget.item(selectedRow, 7).text()\r\n        selectedTrip.price = db.selectAll(\"Trip\",f\"Trip.trip_id = '{selectedTrip.trip_id}'\")[0].price\r\n        self.gotocanceltrip()\r\n    def gotocanceltrip(self):\r\n        if datetime.strptime(selectedTrip.start_date, '%Y-%m-%d %H:%M') < datetime.now():\r\n            self.error.setText(\"You can't cancel a trip that already started!\")\r\n        else:\r\n            widget.removeWidget(self)\r\n            widget.addWidget(CancelTripScreen())\r\n            widget.setCurrentIndex(widget.currentIndex() + 1)\r\n\r\n\r\nclass CancelTripScreen(QDialog):\r\n    def __init__(self):\r\n        super(CancelTripScreen, self).__init__()\r\n        loadUi(\"ui/CancelBooking.ui\", self)\r\n        self.cancelButton.clicked.connect(self.cancelBooking)\r\n        self.returnButton.clicked.connect(self.returnPrevScreen)\r\n        self.loadBookingInfo()\r\n    def returnPrevScreen(self):\r\n        widget.removeWidget(self)\r\n    def loadBookingInfo(self):\r\n        self.departureStationLabel.setText(selectedTrip.departure_station)\r\n        self.arrivalStationLabel.setText(selectedTrip.arrival_station)\r\n        self.startDateLabel.setText(str(selectedTrip.start_date))\r\n        self.endDateLabel.setText(str(selectedTrip.end_date))\r\n        self.seatsCountLabel.setText(str(selectedBooking.no_of_seats))\r\n        self.totalPriceLabel.setText(str(selectedBooking.price))\r\n        self.inputSeatsCount.setMaximum(int(selectedBooking.no_of_seats))\r\n    def cancelBooking(self):\r\n        seatsToCancel = int(self.inputSeatsCount.text())\r\n        if seatsToCancel > int(selectedBooking.no_of_seats):\r\n            self.error.setText(\"Not enough seats!\")\r\n        elif seatsToCancel == int(selectedBooking.no_of_seats):\r\n            db.deleteRecord(selectedBooking)\r\n            self.MsgBox()\r\n            self.returnPrevScreen()\r\n\r\n        else:\r\n            selectedBooking.account = loggedInUser\r\n            selectedBooking.trip = selectedTrip\r\n            selectedBooking.no_of_seats = int(selectedBooking.no_of_seats) - seatsToCancel\r\n            selectedBooking.price = float(selectedBooking.price) - (seatsToCancel * int(selectedBooking.trip.price))\r\n            db.update(selectedBooking)\r\n            self.MsgBox()\r\n            self.returnPrevScreen()\r\n    def MsgBox(self):\r\n        msg = QMessageBox()\r\n        msg.setWindowTitle(\"Success cancellation!\")\r\n        msg.setText(\"Booking canceled successfully!\")\r\n        msg.setIcon(QMessageBox.Information)\r\n        msg.exec_()\r\n\r\n\r\nclass ShowMatchingTripsScreen(QDialog):\r\n    def __init__(self):\r\n        super(ShowMatchingTripsScreen, self).__init__()\r\n        # load UI\r\n        loadUi(\"ui/ShowTrips.ui\", self)\r\n        self.tableWidget.horizontalHeader().setSectionResizeMode(QHeaderView.ResizeToContents)\r\n        self.tableWidget.setHorizontalHeaderLabels(\r\n            [\"Trip Id\", \"Departure Station\", \"Arrival Station\", \"Price\", \"Start Date\", \"End Date\", \"Train ID\"])\r\n        self.tableWidget.setSelectionBehavior(QTableView.SelectRows)\r\n        self.loadTrips()\r\n        self.returnButton.clicked.connect(self.returnPrevScreen)\r\n        self.tableWidget.doubleClicked.connect(self.getClickedCell)\r\n        self.instructionLabel.setText(\"Please double click on the trip to book it :)\")\r\n\r\n    def getClickedCell(self, index):\r\n        row = index.row()\r\n        column = index.column()\r\n        if column >= 0:\r\n            selectedTrip.trip_id = self.tableWidget.item(row, 0).text()\r\n            selectedTrip.departure_station = self.tableWidget.item(row, 1).text()\r\n            selectedTrip.arrival_station = self.tableWidget.item(row, 2).text()\r\n            selectedTrip.price = float(self.tableWidget.item(row, 3).text())\r\n            selectedTrip.start_date = self.tableWidget.item(row, 4).text()\r\n            selectedTrip.end_date = self.tableWidget.item(row, 5).text()\r\n            trainid = int(self.tableWidget.item(row, 6).text())\r\n            selectedTrip.train = db.selectAll(\"Train\", f\"train_id = '{trainid}'\")[0]\r\n            self.action()\r\n\r\n    def clearSelected(self):\r\n        # reset the selected train data to none\r\n        selectedTrip.departure_station = \"\"\r\n        selectedTrip.arrival_station = \"\"\r\n        selectedTrip.price = \"\"\r\n        selectedTrip.start_date = \"\"\r\n        selectedTrip.end_date = \"\"\r\n        selectedTrip.train = None\r\n        matchingTrips.clear()\r\n\r\n    def returnPrevScreen(self):\r\n        self.clearSelected()\r\n        widget.removeWidget(self)\r\n\r\n    def loadTrips(self):\r\n        self.tableWidget.setRowCount(len(matchingTrips))\r\n        tableRow = 0\r\n        for row in matchingTrips:\r\n            self.tableWidget.setItem(tableRow, 0, QtWidgets.QTableWidgetItem(str(row.trip_id)))\r\n            self.tableWidget.setItem(tableRow, 1, QtWidgets.QTableWidgetItem(row.departure_station))\r\n            self.tableWidget.setItem(tableRow, 2, QtWidgets.QTableWidgetItem(row.arrival_station))\r\n            self.tableWidget.setItem(tableRow, 3, QtWidgets.QTableWidgetItem(str(row.price)))\r\n            self.tableWidget.setItem(tableRow, 4, QtWidgets.QTableWidgetItem(str(row.start_date)))\r\n            self.tableWidget.setItem(tableRow, 5, QtWidgets.QTableWidgetItem(str(row.end_date)))\r\n            self.tableWidget.setItem(tableRow, 6, QtWidgets.QTableWidgetItem(str(row.train.train_id)))\r\n            tableRow += 1\r\n\r\n    def action(self):\r\n        if loggedInUser.role == \"admin\":\r\n            widget.addWidget(UpdateTripScreen())\r\n            widget.setCurrentIndex(widget.currentIndex() + 1)\r\n        else:\r\n            widget.addWidget(BookTripScreen())\r\n            widget.setCurrentIndex(widget.currentIndex() + 1)\r\n\r\n\r\nclass FindTripScreen(QDialog):\r\n    def __init__(self):\r\n        super(FindTripScreen, self).__init__()\r\n        # load UI\r\n        loadUi(\"ui/FindTrip.ui\", self)\r\n        txtRegex = QRegExp(\"[a-zA-Z]+\")\r\n        stringValidator = QRegExpValidator(txtRegex)\r\n        self.inputDepartureStation.setValidator(stringValidator)\r\n        self.inputArrivalStation.setValidator(stringValidator)\r\n        self.inputStartDate.setMinimumDateTime(datetime.now())\r\n        self.returnButton.clicked.connect(self.returnPrevScreen)\r\n        self.findTripButton.clicked.connect(self.findTrip)\r\n\r\n    def returnPrevScreen(self):\r\n        widget.removeWidget(self)\r\n\r\n    def showMessageBox(self):\r\n        msg = QMessageBox()\r\n        msg.setWindowTitle(\"Not found!\")\r\n        msg.setText(\"No available seats found that satisfy these criteria!\")\r\n        msg.setIcon(QMessageBox.Information)\r\n        msg.exec_()\r\n\r\n    def findTrip(self):\r\n        departure_station = self.inputDepartureStation.text()\r\n        arrival_station = self.inputArrivalStation.text()\r\n        start_date = self.inputStartDate.dateTime().toPyDateTime().strftime('%Y-%m-%d %H:%M')\r\n        no_of_seats = int(self.inputSeatsCount.text())\r\n        if len(str(no_of_seats)) == 0 or len(departure_station) == 0 or len(arrival_station) == 0:\r\n            self.error.setText(\"Cannot search without the required fields!\")\r\n        else:\r\n            matchingTrips.extend(db.getTrips(no_of_seats, arrival_station, departure_station, start_date))\r\n            if (len(matchingTrips)) == 0:\r\n                self.showMessageBox()\r\n            else:\r\n                widget.addWidget(ShowMatchingTripsScreen())\r\n                widget.setCurrentIndex(widget.currentIndex() + 1)\r\n\r\nclass AdminOptionsScreen(QDialog):\r\n    def __init__(self):\r\n        super(AdminOptionsScreen, self).__init__()\r\n        loadUi(\"ui/adminOptions.ui\", self)\r\n        self.addTrainButton.clicked.connect(self.gotoaddtrain)\r\n        self.updateTrainButton.clicked.connect(self.gotoshowtrains)\r\n        self.addTripButton.clicked.connect(self.gotoaddtrip)\r\n        self.updateTripButton.clicked.connect(self.gotoshowtrips)\r\n        self.returnButton.clicked.connect(self.returnPrevScreen)\r\n\r\n    def returnPrevScreen(self):\r\n        widget.removeWidget(self)\r\n\r\n    def gotoaddtrain(self):\r\n        addTrain = AddTrainScreen()\r\n        widget.addWidget(addTrain)\r\n        widget.setCurrentIndex(widget.currentIndex() + 1)\r\n\r\n    def gotoaddtrip(self):\r\n        addTrip = AddTripScreen()\r\n        widget.addWidget(addTrip)\r\n        widget.setCurrentIndex(widget.currentIndex() + 1)\r\n\r\n    def gotoshowtrips(self):\r\n        showTrips = ShowAllTrips()\r\n        widget.addWidget(showTrips)\r\n        widget.setCurrentIndex(widget.currentIndex() + 1)\r\n\r\n    def gotoshowtrains(self):\r\n        showTrains = ShowAllTrains()\r\n        widget.addWidget(showTrains)\r\n        widget.setCurrentIndex(widget.currentIndex() + 1)\r\n\r\n\r\nclass UserOptionsScreen(QDialog):\r\n    def __init__(self):\r\n        super(UserOptionsScreen, self).__init__()\r\n        loadUi(\"ui/userOptions.ui\", self)\r\n        self.updateInfoButton.clicked.connect(self.gotoupdateInfo)\r\n        self.bookButton.clicked.connect(self.gotobooktrip)\r\n        self.tripsButton.clicked.connect(self.gototrips)\r\n        self.findTripButton.clicked.connect(self.gotofindtrip)\r\n        self.returnButton.clicked.connect(self.returnPrevScreen)\r\n\r\n    def returnPrevScreen(self):\r\n        widget.removeWidget(self)\r\n\r\n    def gototrips(self):\r\n        cancelTrip = ShowBookings()\r\n        widget.addWidget(cancelTrip)\r\n        widget.setCurrentIndex(widget.currentIndex() + 1)\r\n\r\n    def gotobooktrip(self):\r\n        bookTrip = ShowAllTrips()\r\n        widget.addWidget(bookTrip)\r\n        widget.setCurrentIndex(widget.currentIndex() + 1)\r\n\r\n\r\n    def gotoupdateInfo(self):\r\n        updateInfo = UpdateUserScreen()\r\n        widget.addWidget(updateInfo)\r\n        widget.setCurrentIndex(widget.currentIndex() + 1)\r\n\r\n    def gotofindtrip(self):\r\n        findTrip = FindTripScreen()\r\n        widget.addWidget(findTrip)\r\n        widget.setCurrentIndex(widget.currentIndex() + 1)\r\n\r\n\r\n# main\r\nif __name__ == \"__main__\":\r\n    app = QApplication(sys.argv)\r\n    app.setApplicationName(\"Ticket Trackr\")\r\n    app.setWindowIcon(QIcon(\"img/icon.png\"))\r\n    # splash screen\r\n    splash = SplashScreen()\r\n    # main window\r\n    main = MainScreen()\r\n    widget = QtWidgets.QStackedWidget()\r\n    widget.addWidget(main)\r\n    widget.setFixedWidth(800)\r\n    widget.setFixedHeight(840)\r\n    widget.show()\r\n    splash.finish(widget)\r\n    # run app\r\n    app.exec_()
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app.py b/app.py
--- a/app.py	(revision 14bbe1ef74920722298f2d57c9ea632785e8271e)
+++ b/app.py	(date 1684837078119)
@@ -366,7 +366,6 @@
         self.inputCapacity.setValidator(intValidator)
         self.inputNumofcart.setValidator(intValidator)
         self.inputManufacturer.setValidator(stringValidator)
-        self.inputCapacity.setReadOnly(True)
 
     def showMessageBox(self):
         msg = QMessageBox()
@@ -454,8 +453,8 @@
         departure = self.inputDepartureStation.text()
         arrival = self.inputArrivalStation.text()
         trainID =self.inputTrainID.text()
-        startdate = self.inputStartDate.dateTime().toPyDateTime().strftime("%Y-%m-%d %H:%M")
-        enddate = self.inputEndDate.dateTime().toPyDateTime().strftime("%Y-%m-%d %H:%M")
+        startdate = self.inputStartDate.dateTime().toPyDateTime().replace(second=0, microsecond=0).strftime('%Y-%m-%d %H:%M:%S')
+        enddate = self.inputEndDate.dateTime().toPyDateTime().replace(second=0, microsecond=0).strftime('%Y-%m-%d %H:%M:%S')
         if len(str(price)) == 0 or len(departure) == 0 or len(arrival) == 0 or len(trainID) == 0:
             self.error.setText("Cannot add without the required fields!")
         elif not db.count("Train", f"train_id ='{trainID}'") == 1:
@@ -509,8 +508,8 @@
         self.inputDepartureStation.setText(selectedTrip.departure_station)
         self.inputArrivalStation.setText(selectedTrip.arrival_station)
         self.inputTrainID.setText(str(selectedTrip.train.train_id))
-        startDate = datetime.strptime(selectedTrip.start_date, '%Y-%m-%d %H:%M')
-        endDate = datetime.strptime(selectedTrip.end_date, '%Y-%m-%d %H:%M')
+        startDate = datetime.strptime(selectedTrip.start_date, '%Y-%m-%d %H:%M:%S').replace(second=0, microsecond=0)
+        endDate = datetime.strptime(selectedTrip.end_date, '%Y-%m-%d %H:%M:%S').replace(second=0, microsecond=0)
         self.inputStartDate.setDateTime(startDate)
         self.inputEndDate.setDateTime(endDate)
 
@@ -519,8 +518,8 @@
         departure = self.inputDepartureStation.text()
         arrival = self.inputArrivalStation.text()
         trainID = self.inputTrainID.text()
-        startdate = self.inputStartDate.dateTime().toPyDateTime().strftime("%Y-%m-%d %H:%M")
-        enddate = self.inputEndDate.dateTime().toPyDateTime().strftime("%Y-%m-%d %H:%M")
+        startdate = self.inputStartDate.dateTime().toPyDateTime().replace(second=0, microsecond=0).strftime('%Y-%m-%d %H:%M:%S')
+        enddate = self.inputEndDate.dateTime().toPyDateTime().replace(second=0, microsecond=0).strftime('%Y-%m-%d %H:%M:%S')
         if len(str(price)) == 0 or len(departure) == 0 or len(arrival) == 0 or len(trainID) == 0:
             self.error.setText("Cannot add without the required fields!")
         elif startdate >= enddate:
@@ -550,7 +549,10 @@
         self.loadTrips()
         self.returnButton.clicked.connect(self.returnPrevScreen)
         self.tableWidget.doubleClicked.connect(self.getClickedCell)
-        self.instructionLabel.setText("Please double click on the trip to update it :)")
+        if loggedInUser.role == "admin":
+            self.instructionLabel.setText("Please double click on the trip to update it :)")
+        elif loggedInUser.role == "customer":
+            self.instructionLabel.setText("Please double click on the trip to book it :)")
 
     def getClickedCell(self, index):
         row = index.row()
@@ -619,6 +621,7 @@
         selectedTrip.price = ""
         selectedTrip.start_date = ""
         selectedTrip.end_date = ""
+        matchingTrips.clear()
     def returnPrevScreen(self):
         self.clearSelected()
         widget.removeWidget(self)
@@ -720,7 +723,7 @@
         selectedTrip.price = db.selectAll("Trip",f"Trip.trip_id = '{selectedTrip.trip_id}'")[0].price
         self.gotocanceltrip()
     def gotocanceltrip(self):
-        if datetime.strptime(selectedTrip.start_date, '%Y-%m-%d %H:%M') < datetime.now():
+        if datetime.strptime(selectedTrip.start_date, '%Y-%m-%d %H:%M:%S').replace(second=0, microsecond=0) < datetime.now().replace(second=0, microsecond=0):
             self.error.setText("You can't cancel a trip that already started!")
         else:
             widget.removeWidget(self)
@@ -860,7 +863,7 @@
     def findTrip(self):
         departure_station = self.inputDepartureStation.text()
         arrival_station = self.inputArrivalStation.text()
-        start_date = self.inputStartDate.dateTime().toPyDateTime().strftime('%Y-%m-%d %H:%M')
+        start_date = self.inputStartDate.dateTime().toPyDateTime().replace(second=0, microsecond=0).strftime('%Y-%m-%d %H:%M:%S')
         no_of_seats = int(self.inputSeatsCount.text())
         if len(str(no_of_seats)) == 0 or len(departure_station) == 0 or len(arrival_station) == 0:
             self.error.setText("Cannot search without the required fields!")
Index: main.py
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>import databaseSQL\r\nimport models\r\nfrom datetime import datetime\r\ndb = databaseSQL.database()\r\n\r\n# trip = db.selectAll(\"Trip\")[0]\r\n# acc = db.selectAll(\"Account\")[3]\r\n# booking = models.Booking()\r\n# booking.account = acc\r\n# booking.trip = trip\r\n# booking.set_seats_num(1)\r\n# db.addRecord(booking)\r\n# db.deleteRecord(\"Trip\",\"trip_id = 3\")\r\n\r\n# for i in db.getTrips(5):\r\n#     print(i.departure_station,i.trip_id)\r\n#add trip\r\n# trip = models.Trip()\r\n# trip.train = db.selectAll(\"Train\")[0]\r\n# trip.departure_station = \"cairo\"\r\n# trip.arrival_station = \"hurghada\"\r\n# trip.start_date = datetime(2023, 5, 25, 0, 0, 0, 0)\r\n# trip.end_date = datetime(2023, 5, 25, 6, 0, 0, 0)\r\n# trip.price = 400\r\n# db.addRecord(trip)\r\n# for i in db.selectAll(\"Trip\"):\r\n#     print(i.trip_id,i.departure_station,i.arrival_station)\r\n# for i in db.getTrips(1,arrival_station=\"hurghada\",departure_station=\"cairo\"):\r\n#     print(\"found\")\r\n#\r\n# # for i in db.getTrips(1,arrival_station=\"dahab\",departure_station=\"cairo\"):\r\n# #     print(\"found\")\r\nfor i in db.getTrips(5,):\r\n    print(i.train.train_id)
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/main.py b/main.py
--- a/main.py	(revision 14bbe1ef74920722298f2d57c9ea632785e8271e)
+++ b/main.py	(date 1684833151680)
@@ -30,5 +30,7 @@
 #
 # # for i in db.getTrips(1,arrival_station="dahab",departure_station="cairo"):
 # #     print("found")
-for i in db.getTrips(5,):
-    print(i.train.train_id)
\ No newline at end of file
+# for i in db.getTrips(5,):
+#     print(i.train.train_id)
+
+# db.deleteRecord(db.selectAll("Trip")[0])
Index: .idea/workspace.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<project version=\"4\">\r\n  <component name=\"ChangeListManager\">\r\n    <list default=\"true\" id=\"f928daff-1589-44be-9094-a10f197f7454\" name=\"Changes\" comment=\"fix bugs\">\r\n      <change beforePath=\"$PROJECT_DIR$/.idea/workspace.xml\" beforeDir=\"false\" afterPath=\"$PROJECT_DIR$/.idea/workspace.xml\" afterDir=\"false\" />\r\n      <change beforePath=\"$PROJECT_DIR$/app.py\" beforeDir=\"false\" afterPath=\"$PROJECT_DIR$/app.py\" afterDir=\"false\" />\r\n    </list>\r\n    <option name=\"SHOW_DIALOG\" value=\"false\" />\r\n    <option name=\"HIGHLIGHT_CONFLICTS\" value=\"true\" />\r\n    <option name=\"HIGHLIGHT_NON_ACTIVE_CHANGELIST\" value=\"false\" />\r\n    <option name=\"LAST_RESOLUTION\" value=\"IGNORE\" />\r\n  </component>\r\n  <component name=\"Git.Settings\">\r\n    <option name=\"RECENT_GIT_ROOT_PATH\" value=\"$PROJECT_DIR$\" />\r\n  </component>\r\n  <component name=\"ProjectId\" id=\"2Q8e2f2HLRkDfudO8bZoWgaFRPt\" />\r\n  <component name=\"ProjectLevelVcsManager\" settingsEditedManually=\"true\" />\r\n  <component name=\"ProjectViewState\">\r\n    <option name=\"hideEmptyMiddlePackages\" value=\"true\" />\r\n    <option name=\"showLibraryContents\" value=\"true\" />\r\n  </component>\r\n  <component name=\"PropertiesComponent\">\r\n    <property name=\"RunOnceActivity.OpenProjectViewOnStart\" value=\"true\" />\r\n    <property name=\"RunOnceActivity.ShowReadmeOnStart\" value=\"true\" />\r\n    <property name=\"last_opened_file_path\" value=\"$PROJECT_DIR$\" />\r\n    <property name=\"settings.editor.selected.configurable\" value=\"preferences.updates\" />\r\n  </component>\r\n  <component name=\"RunManager\">\r\n    <configuration name=\"app\" type=\"PythonConfigurationType\" factoryName=\"Python\" temporary=\"true\" nameIsGenerated=\"true\">\r\n      <option name=\"INTERPRETER_OPTIONS\" value=\"\" />\r\n      <option name=\"PARENT_ENVS\" value=\"true\" />\r\n      <envs>\r\n        <env name=\"PYTHONUNBUFFERED\" value=\"1\" />\r\n      </envs>\r\n      <option name=\"SDK_HOME\" value=\"C:\\Users\\nadam\\PycharmProjects\\BonusGUIDB\\venv\\Scripts\\python.exe\" />\r\n      <option name=\"WORKING_DIRECTORY\" value=\"$PROJECT_DIR$\" />\r\n      <option name=\"IS_MODULE_SDK\" value=\"false\" />\r\n      <option name=\"ADD_CONTENT_ROOTS\" value=\"true\" />\r\n      <option name=\"ADD_SOURCE_ROOTS\" value=\"true\" />\r\n      <module name=\"\" />\r\n      <option name=\"SCRIPT_NAME\" value=\"$PROJECT_DIR$/app.py\" />\r\n      <option name=\"PARAMETERS\" value=\"\" />\r\n      <option name=\"SHOW_COMMAND_LINE\" value=\"false\" />\r\n      <option name=\"EMULATE_TERMINAL\" value=\"false\" />\r\n      <option name=\"MODULE_MODE\" value=\"false\" />\r\n      <option name=\"REDIRECT_INPUT\" value=\"false\" />\r\n      <option name=\"INPUT_FILE\" value=\"\" />\r\n      <method v=\"2\" />\r\n    </configuration>\r\n    <recent_temporary>\r\n      <list>\r\n        <item itemvalue=\"Python.app\" />\r\n      </list>\r\n    </recent_temporary>\r\n  </component>\r\n  <component name=\"SpellCheckerSettings\" RuntimeDictionaries=\"0\" Folders=\"0\" CustomDictionaries=\"0\" DefaultDictionary=\"application-level\" UseSingleDictionary=\"true\" transferred=\"true\" />\r\n  <component name=\"TaskManager\">\r\n    <task active=\"true\" id=\"Default\" summary=\"Default task\">\r\n      <changelist id=\"f928daff-1589-44be-9094-a10f197f7454\" name=\"Changes\" comment=\"edit ui\" />\r\n      <created>1684739433297</created>\r\n      <option name=\"number\" value=\"Default\" />\r\n      <option name=\"presentableId\" value=\"Default\" />\r\n      <updated>1684739433297</updated>\r\n    </task>\r\n    <task id=\"LOCAL-00001\" summary=\"fix bug\">\r\n      <created>1684741337000</created>\r\n      <option name=\"number\" value=\"00001\" />\r\n      <option name=\"presentableId\" value=\"LOCAL-00001\" />\r\n      <option name=\"project\" value=\"LOCAL\" />\r\n      <updated>1684741337000</updated>\r\n    </task>\r\n    <task id=\"LOCAL-00002\" summary=\"made capacity readonly\">\r\n      <created>1684757101579</created>\r\n      <option name=\"number\" value=\"00002\" />\r\n      <option name=\"presentableId\" value=\"LOCAL-00002\" />\r\n      <option name=\"project\" value=\"LOCAL\" />\r\n      <updated>1684757101579</updated>\r\n    </task>\r\n    <task id=\"LOCAL-00003\" summary=\"edit book train\">\r\n      <created>1684763005860</created>\r\n      <option name=\"number\" value=\"00003\" />\r\n      <option name=\"presentableId\" value=\"LOCAL-00003\" />\r\n      <option name=\"project\" value=\"LOCAL\" />\r\n      <updated>1684763005860</updated>\r\n    </task>\r\n    <task id=\"LOCAL-00004\" summary=\"edit book trip\">\r\n      <created>1684766396960</created>\r\n      <option name=\"number\" value=\"00004\" />\r\n      <option name=\"presentableId\" value=\"LOCAL-00004\" />\r\n      <option name=\"project\" value=\"LOCAL\" />\r\n      <updated>1684766396960</updated>\r\n    </task>\r\n    <task id=\"LOCAL-00005\" summary=\"fix bug\">\r\n      <created>1684770610457</created>\r\n      <option name=\"number\" value=\"00005\" />\r\n      <option name=\"presentableId\" value=\"LOCAL-00005\" />\r\n      <option name=\"project\" value=\"LOCAL\" />\r\n      <updated>1684770610457</updated>\r\n    </task>\r\n    <task id=\"LOCAL-00006\" summary=\"fix bug\">\r\n      <created>1684770774864</created>\r\n      <option name=\"number\" value=\"00006\" />\r\n      <option name=\"presentableId\" value=\"LOCAL-00006\" />\r\n      <option name=\"project\" value=\"LOCAL\" />\r\n      <updated>1684770774864</updated>\r\n    </task>\r\n    <task id=\"LOCAL-00007\" summary=\"fix bug\">\r\n      <created>1684775841696</created>\r\n      <option name=\"number\" value=\"00007\" />\r\n      <option name=\"presentableId\" value=\"LOCAL-00007\" />\r\n      <option name=\"project\" value=\"LOCAL\" />\r\n      <updated>1684775841696</updated>\r\n    </task>\r\n    <task id=\"LOCAL-00008\" summary=\"edit ui\">\r\n      <created>1684818092372</created>\r\n      <option name=\"number\" value=\"00008\" />\r\n      <option name=\"presentableId\" value=\"LOCAL-00008\" />\r\n      <option name=\"project\" value=\"LOCAL\" />\r\n      <updated>1684818092372</updated>\r\n    </task>\r\n    <task id=\"LOCAL-00009\" summary=\"edit ui\">\r\n      <created>1684818347393</created>\r\n      <option name=\"number\" value=\"00009\" />\r\n      <option name=\"presentableId\" value=\"LOCAL-00009\" />\r\n      <option name=\"project\" value=\"LOCAL\" />\r\n      <updated>1684818347393</updated>\r\n    </task>\r\n    <task id=\"LOCAL-00010\" summary=\"fix bugs\">\r\n      <created>1684822115212</created>\r\n      <option name=\"number\" value=\"00010\" />\r\n      <option name=\"presentableId\" value=\"LOCAL-00010\" />\r\n      <option name=\"project\" value=\"LOCAL\" />\r\n      <updated>1684822115212</updated>\r\n    </task>\r\n    <task id=\"LOCAL-00011\" summary=\"fix bugs\">\r\n      <created>1684822327273</created>\r\n      <option name=\"number\" value=\"00011\" />\r\n      <option name=\"presentableId\" value=\"LOCAL-00011\" />\r\n      <option name=\"project\" value=\"LOCAL\" />\r\n      <updated>1684822327273</updated>\r\n    </task>\r\n    <task id=\"LOCAL-00012\" summary=\"fix bugs\">\r\n      <created>1684828965964</created>\r\n      <option name=\"number\" value=\"00012\" />\r\n      <option name=\"presentableId\" value=\"LOCAL-00012\" />\r\n      <option name=\"project\" value=\"LOCAL\" />\r\n      <updated>1684828965965</updated>\r\n    </task>\r\n    <task id=\"LOCAL-00013\" summary=\"fix bugs\">\r\n      <created>1684828977482</created>\r\n      <option name=\"number\" value=\"00013\" />\r\n      <option name=\"presentableId\" value=\"LOCAL-00013\" />\r\n      <option name=\"project\" value=\"LOCAL\" />\r\n      <updated>1684828977482</updated>\r\n    </task>\r\n    <option name=\"localTasksCounter\" value=\"14\" />\r\n    <servers />\r\n  </component>\r\n  <component name=\"Vcs.Log.Tabs.Properties\">\r\n    <option name=\"TAB_STATES\">\r\n      <map>\r\n        <entry key=\"MAIN\">\r\n          <value>\r\n            <State />\r\n          </value>\r\n        </entry>\r\n      </map>\r\n    </option>\r\n    <option name=\"oldMeFiltersMigrated\" value=\"true\" />\r\n  </component>\r\n  <component name=\"VcsManagerConfiguration\">\r\n    <MESSAGE value=\"made capacity readonly\" />\r\n    <MESSAGE value=\"edit book train\" />\r\n    <MESSAGE value=\"edit book trip\" />\r\n    <MESSAGE value=\"fix bug\" />\r\n    <MESSAGE value=\"edit ui\" />\r\n    <MESSAGE value=\"fix bugs\" />\r\n    <option name=\"LAST_COMMIT_MESSAGE\" value=\"fix bugs\" />\r\n  </component>\r\n  <component name=\"XDebuggerManager\">\r\n    <watches-manager>\r\n      <configuration name=\"PythonConfigurationType\">\r\n        <watch expression=\"row.cursor_description.__len__()\" />\r\n      </configuration>\r\n    </watches-manager>\r\n  </component>\r\n</project>
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/.idea/workspace.xml b/.idea/workspace.xml
--- a/.idea/workspace.xml	(revision 14bbe1ef74920722298f2d57c9ea632785e8271e)
+++ b/.idea/workspace.xml	(date 1684834832411)
@@ -4,6 +4,7 @@
     <list default="true" id="f928daff-1589-44be-9094-a10f197f7454" name="Changes" comment="fix bugs">
       <change beforePath="$PROJECT_DIR$/.idea/workspace.xml" beforeDir="false" afterPath="$PROJECT_DIR$/.idea/workspace.xml" afterDir="false" />
       <change beforePath="$PROJECT_DIR$/app.py" beforeDir="false" afterPath="$PROJECT_DIR$/app.py" afterDir="false" />
+      <change beforePath="$PROJECT_DIR$/main.py" beforeDir="false" afterPath="$PROJECT_DIR$/main.py" afterDir="false" />
     </list>
     <option name="SHOW_DIALOG" value="false" />
     <option name="HIGHLIGHT_CONFLICTS" value="true" />
@@ -25,7 +26,7 @@
     <property name="last_opened_file_path" value="$PROJECT_DIR$" />
     <property name="settings.editor.selected.configurable" value="preferences.updates" />
   </component>
-  <component name="RunManager">
+  <component name="RunManager" selected="Python.app">
     <configuration name="app" type="PythonConfigurationType" factoryName="Python" temporary="true" nameIsGenerated="true">
       <option name="INTERPRETER_OPTIONS" value="" />
       <option name="PARENT_ENVS" value="true" />
@@ -39,6 +40,27 @@
       <option name="ADD_SOURCE_ROOTS" value="true" />
       <module name="" />
       <option name="SCRIPT_NAME" value="$PROJECT_DIR$/app.py" />
+      <option name="PARAMETERS" value="" />
+      <option name="SHOW_COMMAND_LINE" value="false" />
+      <option name="EMULATE_TERMINAL" value="false" />
+      <option name="MODULE_MODE" value="false" />
+      <option name="REDIRECT_INPUT" value="false" />
+      <option name="INPUT_FILE" value="" />
+      <method v="2" />
+    </configuration>
+    <configuration name="main" type="PythonConfigurationType" factoryName="Python" temporary="true" nameIsGenerated="true">
+      <option name="INTERPRETER_OPTIONS" value="" />
+      <option name="PARENT_ENVS" value="true" />
+      <envs>
+        <env name="PYTHONUNBUFFERED" value="1" />
+      </envs>
+      <option name="SDK_HOME" value="C:\Users\nadam\PycharmProjects\BonusGUIDB\venv\Scripts\python.exe" />
+      <option name="WORKING_DIRECTORY" value="$PROJECT_DIR$" />
+      <option name="IS_MODULE_SDK" value="false" />
+      <option name="ADD_CONTENT_ROOTS" value="true" />
+      <option name="ADD_SOURCE_ROOTS" value="true" />
+      <module name="" />
+      <option name="SCRIPT_NAME" value="$PROJECT_DIR$/main.py" />
       <option name="PARAMETERS" value="" />
       <option name="SHOW_COMMAND_LINE" value="false" />
       <option name="EMULATE_TERMINAL" value="false" />
@@ -50,6 +72,7 @@
     <recent_temporary>
       <list>
         <item itemvalue="Python.app" />
+        <item itemvalue="Python.main" />
       </list>
     </recent_temporary>
   </component>
@@ -153,7 +176,14 @@
       <option name="project" value="LOCAL" />
       <updated>1684828977482</updated>
     </task>
-    <option name="localTasksCounter" value="14" />
+    <task id="LOCAL-00014" summary="fix bugs">
+      <created>1684831957937</created>
+      <option name="number" value="00014" />
+      <option name="presentableId" value="LOCAL-00014" />
+      <option name="project" value="LOCAL" />
+      <updated>1684831957937</updated>
+    </task>
+    <option name="localTasksCounter" value="15" />
     <servers />
   </component>
   <component name="Vcs.Log.Tabs.Properties">
@@ -181,6 +211,10 @@
     <watches-manager>
       <configuration name="PythonConfigurationType">
         <watch expression="row.cursor_description.__len__()" />
+        <watch expression="row.cursor_description.__len__()" language="Python" />
+        <watch expression="self" />
+        <watch expression="row.cursor_description.__len__()" />
+        <watch expression="self" />
       </configuration>
     </watches-manager>
   </component>
